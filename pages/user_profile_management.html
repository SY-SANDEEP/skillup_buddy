<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Profile Management - SkillUp Buddy</title>
    
    <link rel="stylesheet" href="../css/main.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
   
</head>
<body class="bg-background min-h-screen">
    <!-- Header -->
    <header class="bg-surface shadow-sm border-b border-border">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo -->
                <div class="flex items-center">
                    <a href="user_dashboard.html" class="flex items-center space-x-2">
                        <div class="w-8 h-8 bg-primary rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M10.394 2.08a1 1 0 00-.788 0l-7 3a1 1 0 000 1.84L5.25 8.051a.999.999 0 01.356-.257l4-1.714a1 1 0 11.788 1.84L7.667 9.088l1.94.831a1 1 0 00.787 0l7-3a1 1 0 000-1.84l-7-3zM3.31 9.397L5 10.12v4.102a8.969 8.969 0 00-1.05-.174 1 1 0 01-.89-.89 11.115 11.115 0 01.25-3.762zM9.3 16.573A9.026 9.026 0 007 14.935v-3.957l1.818.78a3 3 0 002.364 0l5.508-2.361a11.026 11.026 0 01.25 3.762 1 1 0 01-.89.89 8.968 8.968 0 00-5.35 2.524 1 1 0 01-1.4 0zM6 18a1 1 0 001-1v-2.065a8.935 8.935 0 00-2-.712V17a1 1 0 001 1z"/>
                            </svg>
                        </div>
                        <span class="text-xl font-semibold text-text-primary">SkillUp Buddy</span>
                    </a>
                </div>

                <!-- Navigation -->
                <nav class="hidden md:flex items-center space-x-8">
                    <a href="user_dashboard.html" class="text-text-secondary hover:text-primary transition-colors duration-200">Dashboard</a>
                    <a href="course_recommendations_dashboard.html" class="text-text-secondary hover:text-primary transition-colors duration-200">Courses</a>
                    <a href="interactive_skills_quiz.html" class="text-text-secondary hover:text-primary transition-colors duration-200">Quiz</a>
                </nav>

                <!-- User Menu -->
                <div class="flex items-center space-x-4">
                    <div class="relative">
                        <button id="userMenuButton" class="flex items-center space-x-2 text-text-secondary hover:text-primary transition-colors duration-200">
                            <div class="w-8 h-8 bg-primary-100 rounded-full flex items-center justify-center overflow-hidden">
                                <img id="userAvatar" src="" alt="Avatar" class="w-8 h-8 rounded-full object-cover hidden" />
                                <span id="userInitials" class="text-primary font-semibold text-sm"></span>
                            </div>
                            <span class="hidden sm:block font-medium" id="userName"></span>

                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                            </svg>
                        </button>
                        
                        <!-- Dropdown Menu -->
                        <div id="userDropdown" class="absolute right-0 mt-2 w-48 bg-surface rounded-lg shadow-lg border border-border hidden z-50">
                            <div class="py-1">
                                <a href="user_profile_management.html" class="block px-4 py-2 text-sm text-primary bg-primary-50 font-medium">Profile Settings</a>
                                <a href="user_dashboard.html" class="block px-4 py-2 text-sm text-text-secondary hover:bg-gray-50">Dashboard</a>
                                <div class="border-t border-border"></div>
                                <a href="user_login.html" class="block px-4 py-2 text-sm text-error hover:bg-error-50">Sign Out</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Breadcrumbs -->
    <div class="bg-surface border-b border-border">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3">
            <nav class="flex" aria-label="Breadcrumb">
                <ol class="flex items-center space-x-2">
                    <li>
                        <a href="user_dashboard.html" class="text-text-secondary hover:text-primary transition-colors duration-200">Dashboard</a>
                    </li>
                    <li>
                        <svg class="w-4 h-4 text-text-tertiary" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
                        </svg>
                    </li>
                    <li>
                        <span class="text-text-primary font-medium">Profile Management</span>
                    </li>
                </ol>
            </nav>
        </div>
    </div>

    <!-- Main Content -->
    <main class="flex-1 py-8 px-4 sm:px-6 lg:px-8">
        <div class="max-w-4xl mx-auto">
            <!-- Page Header -->
            <div class="mb-8">
                <h1 class="text-3xl font-semibold text-text-primary mb-2">Profile Management</h1>
                <p class="text-text-secondary">Update your personal information and learning preferences to get better course recommendations</p>
            </div>

            <!-- Profile Card -->
            <div class="card">
                <!-- Tab Navigation -->
                <div class="border-b border-border">
                    <nav class="flex space-x-8 px-6 pt-6" aria-label="Profile tabs">
                        <button id="personalTab" class="tab-button active py-2 px-1 border-b-2 border-primary text-primary font-medium text-sm">
                            Personal Information
                        </button>
                        <button id="preferencesTab" class="tab-button py-2 px-1 border-b-2 border-transparent text-text-secondary hover:text-text-primary font-medium text-sm">
                            Learning Preferences
                        </button>
                        <button id="settingsTab" class="tab-button py-2 px-1 border-b-2 border-transparent text-text-secondary hover:text-text-primary font-medium text-sm">
                            Account Settings
                        </button>
                    </nav>
                </div>

                <!-- Tab Content -->
                <div class="p-6">
                    <!-- Personal Information Tab -->
                    <div id="personalContent" class="tab-content">
                        <form id="personalForm" class="space-y-6">
                            <!-- Profile Photo Section -->
                            <div class="flex flex-col sm:flex-row sm:items-start space-y-4 sm:space-y-0 sm:space-x-6">
                                <div class="flex-shrink-0">
                                    <div class="relative">
                                        <!-- No default remote src, will be filled by JS/user data -->
                                        <img
                                          id="profilePreview"
                                          src=""
                                          alt="Profile Photo"
                                          class="w-24 h-24 rounded-full object-cover border-4 border-border bg-primary-50" />
                                        <button
                                          type="button"
                                          id="photoUploadBtn"
                                          class="absolute bottom-0 right-0 bg-primary text-white rounded-full p-2 hover:bg-primary-700 transition-colors duration-200 touch-target">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                      d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"/>
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                      d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"/>
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                                <div class="flex-1">
                                    <h3 class="text-lg font-medium text-text-primary mb-2">Profile Photo</h3>
                                    <p class="text-text-secondary text-sm mb-4">
                                        Upload a profile photo to personalize your account. Recommended size: 400x400px
                                    </p>
                                    
                                    <!-- Drag and Drop Area -->
                                    <div
                                      id="dropZone"
                                      class="border-2 border-dashed border-border rounded-lg p-6 text-center hover:border-primary transition-colors duration-200 cursor-pointer">
                                        <svg class="mx-auto h-12 w-12 text-text-tertiary" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                                            <path
                                              d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02"
                                              stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                        <p class="mt-2 text-sm text-text-secondary">
                                            <span class="font-medium text-primary">Click to upload</span> or drag and drop
                                        </p>
                                        <p class="text-xs text-text-tertiary">PNG, JPG, GIF up to 5MB</p>
                                    </div>
                                    <input type="file" id="photoInput" accept="image/*" class="hidden" />
                                </div>
                            </div>

                            <!-- Personal Details -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label for="firstName" class="block text-sm font-medium text-text-primary mb-2">First Name</label>
                                    <input type="text" id="firstName" name="firstName" class="input w-full" required />
                                </div>
                                <div>
                                    <label for="lastName" class="block text-sm font-medium text-text-primary mb-2">Last Name</label>
                                    <input type="text" id="lastName" name="lastName" class="input w-full" required />
                                </div>
                            </div>

                            <div>
                                <label for="email" class="block text-sm font-medium text-text-primary mb-2">Email Address</label>
                                <input type="email" id="email" name="email" class="input w-full" required />
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label for="phone" class="block text-sm font-medium text-text-primary mb-2">Phone Number</label>
                                    <input type="tel" id="phone" name="phone" class="input w-full" />
                                </div>
                                <div>
                                    <label for="location" class="block text-sm font-medium text-text-primary mb-2">Location</label>
                                    <input type="text" id="location" name="location" class="input w-full" />
                                </div>
                            </div>

                            <div>
                                <label for="bio" class="block text-sm font-medium text-text-primary mb-2">Bio</label>
                                <textarea
                                  id="bio"
                                  name="bio"
                                  rows="4"
                                  class="input w-full resize-none"
                                  placeholder="Tell us about yourself and your learning goals..."></textarea>
                            </div>

                            <div class="flex justify-end">
                                <button type="submit" id="savePersonalBtn" class="btn btn-primary touch-target">
                                    <span id="savePersonalText">Save Changes</span>
                                    <svg
                                      id="savePersonalSpinner"
                                      class="animate-spin -ml-1 mr-3 h-5 w-5 text-white hidden"
                                      xmlns="http://www.w3.org/2000/svg"
                                      fill="none"
                                      viewBox="0 0 24 24">
                                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"/>
                                        <path
                                          class="opacity-75"
                                          fill="currentColor"
                                          d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2
                                             5.291A7.962 7.962 0 014 12H0c0 3.042 1.135
                                             5.824 3 7.938l3-2.647z"/>
                                    </svg>
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Learning Preferences Tab -->
                    <div id="preferencesContent" class="tab-content hidden">
                        <form id="preferencesForm" class="space-y-6">
                            <!-- Current Skill Level -->
                            <div>
                                <label class="block text-sm font-medium text-text-primary mb-4">Current Skill Level</label>
                                <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                                    <label class="skill-level-option">
                                        <input type="radio" name="skillLevel" value="beginner" class="sr-only" />
                                        <div class="skill-card p-4 border-2 border-border rounded-lg cursor-pointer hover:border-primary transition-colors duration-200 text-center">
                                            <div class="w-8 h-8 bg-primary-100 rounded-full flex items-center justify-center mx-auto mb-2">
                                                <svg class="w-4 h-4 text-primary" fill="currentColor" viewBox="0 0 20 20">
                                                    <path
                                                      d="M9.049 2.927c.3-.921 1.603-.921 1.902
                                                         0l1.07 3.292a1 1 0 00.95.69h3.462c.969
                                                         0 1.371 1.24.588 1.81l-2.8
                                                         2.034a1 1 0 00-.364 1.118l1.07
                                                         3.292c.3.921-.755 1.688-1.54
                                                         1.118l-2.8-2.034a1 1 0 00-1.175
                                                         0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1
                                                         1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1
                                                         1 0 00.951-.69l1.07-3.292z"/>
                                                </svg>
                                            </div>
                                            <span class="text-sm font-medium">Beginner</span>
                                        </div>
                                    </label>
                                    <label class="skill-level-option">
                                        <input type="radio" name="skillLevel" value="intermediate" checked class="sr-only" />
                                        <div class="skill-card p-4 border-2 border-primary rounded-lg cursor-pointer hover:border-primary transition-colors duration-200 text-center bg-primary-50">
                                            <div class="w-8 h-8 bg-primary rounded-full flex items-center justify-center mx-auto mb-2">
                                                <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 20 20">
                                                    <path
                                                      d="M9.049 2.927c.3-.921 1.603-.921 1.902
                                                         0l1.07 3.292a1 1 0 00.95.69h3.462c.969
                                                         0 1.371 1.24.588 1.81l-2.8
                                                         2.034a1 1 0 00-.364 1.118l1.07
                                                         3.292c.3.921-.755 1.688-1.54
                                                         1.118l-2.8-2.034a1 1 0 00-1.175
                                                         0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1
                                                         1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1
                                                         1 0 00.951-.69l1.07-3.292z"/>
                                                </svg>
                                            </div>
                                            <span class="text-sm font-medium text-primary">Intermediate</span>
                                        </div>
                                    </label>
                                    <label class="skill-level-option">
                                        <input type="radio" name="skillLevel" value="advanced" class="sr-only" />
                                        <div class="skill-card p-4 border-2 border-border rounded-lg cursor-pointer hover:border-primary transition-colors duration-200 text-center">
                                            <div class="w-8 h-8 bg-primary-100 rounded-full flex items-center justify-center mx-auto mb-2">
                                                <svg class="w-4 h-4 text-primary" fill="currentColor" viewBox="0 0 20 20">
                                                    <path
                                                      d="M9.049 2.927c.3-.921 1.603-.921 1.902
                                                         0l1.07 3.292a1 1 0 00.95.69h3.462c.969
                                                         0 1.371 1.24.588 1.81l-2.8
                                                         2.034a1 1 0 00-.364 1.118l1.07
                                                         3.292c.3.921-.755 1.688-1.54
                                                         1.118l-2.8-2.034a1 1 0 00-1.175
                                                         0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1
                                                         1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1
                                                         1 0 00.951-.69l1.07-3.292z"/>
                                                </svg>
                                            </div>
                                            <span class="text-sm font-medium">Advanced</span>
                                        </div>
                                    </label>
                                    <label class="skill-level-option">
                                        <input type="radio" name="skillLevel" value="expert" class="sr-only" />
                                        <div class="skill-card p-4 border-2 border-border rounded-lg cursor-pointer hover:border-primary transition-colors duration-200 text-center">
                                            <div class="w-8 h-8 bg-primary-100 rounded-full flex items-center justify-center mx-auto mb-2">
                                                <svg class="w-4 h-4 text-primary" fill="currentColor" viewBox="0 0 20 20">
                                                    <path
                                                      d="M9.049 2.927c.3-.921 1.603-.921 1.902
                                                         0l1.07 3.292a1 1 0 00.95.69h3.462c.969
                                                         0 1.371 1.24.588 1.81l-2.8
                                                         2.034a1 1 0 00-.364 1.118l1.07
                                                         3.292c.3.921-.755 1.688-1.54
                                                         1.118l-2.8-2.034a1 1 0 00-1.175
                                                         0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1
                                                         1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1
                                                         1 0 00.951-.69l1.07-3.292z"/>
                                                </svg>
                                            </div>
                                            <span class="text-sm font-medium">Expert</span>
                                        </div>
                                    </label>
                                </div>
                            </div>

                            <!-- Learning Interests -->
                            <div>
                                <label class="block text-sm font-medium text-text-primary mb-4">Learning Interests</label>
                                <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                                    <label class="interest-option">
                                        <input type="checkbox" name="interests" value="programming" checked class="sr-only" />
                                        <div class="interest-card p-3 border-2 border-primary rounded-lg cursor-pointer hover:border-primary transition-colors duration-200 bg-primary-50">
                                            <div class="flex items-center space-x-2">
                                                <svg class="w-5 h-5 text-primary" fill="currentColor" viewBox="0 0 20 20">
                                                    <path
                                                      fill-rule="evenodd"
                                                      d="M12.316 3.051a1 1 0 01.633 1.265l-4
                                                         12a1 1 0 11-1.898-.632l4-12a1 1 0
                                                         011.265-.633zM5.707 6.293a1 1 0
                                                         010 1.414L3.414 10l2.293 2.293a1 1
                                                         0 11-1.414 1.414l-3-3a1 1 0
                                                         010-1.414l3-3a1 1 0 011.414
                                                         0zm8.586 0a1 1 0 011.414 0l3 3a1
                                                         1 0 010 1.414l-3 3a1 1 0
                                                         11-1.414-1.414L16.586 10l-2.293-2.293a1
                                                         1 0 010-1.414z"
                                                      clip-rule="evenodd"/>
                                                </svg>
                                                <span class="text-sm font-medium text-primary">Programming</span>
                                            </div>
                                        </div>
                                    </label>
                                    <label class="interest-option">
                                        <input type="checkbox" name="interests" value="design" class="sr-only" />
                                        <div class="interest-card p-3 border-2 border-border rounded-lg cursor-pointer hover:border-primary transition-colors duration-200">
                                            <div class="flex items-center space-x-2">
                                                <svg class="w-5 h-5 text-text-secondary" fill="currentColor" viewBox="0 0 20 20">
                                                    <path
                                                      fill-rule="evenodd"
                                                      d="M4 3a2 2 0 00-2 2v10a2 2 0
                                                         002 2h12a2 2 0 002-2V5a2 2 0
                                                         00-2-2H4zm12 12H4l4-8 3 6 2-4
                                                         3 6z"
                                                      clip-rule="evenodd"/>
                                                </svg>
                                                <span class="text-sm font-medium">Design</span>
                                            </div>
                                        </div>
                                    </label>
                                    <label class="interest-option">
                                        <input type="checkbox" name="interests" value="business" checked class="sr-only" />
                                        <div class="interest-card p-3 border-2 border-primary rounded-lg cursor-pointer hover:border-primary transition-colors duration-200 bg-primary-50">
                                            <div class="flex items-center space-x-2">
                                                <svg class="w-5 h-5 text-primary" fill="currentColor" viewBox="0 0 20 20">
                                                    <path
                                                      d="M13 6a3 3 0 11-6 0 3 3 0
                                                         016 0zM18 8a2 2 0 11-4 0 2 2 0
                                                         014 0zM14 15a4 4 0 00-8 0v3h8v-3z"/>
                                                </svg>
                                                <span class="text-sm font-medium text-primary">Business</span>
                                            </div>
                                        </div>
                                    </label>
                                    <label class="interest-option">
                                        <input type="checkbox" name="interests" value="marketing" class="sr-only" />
                                        <div class="interest-card p-3 border-2 border-border rounded-lg cursor-pointer hover:border-primary transition-colors duration-200">
                                            <div class="flex items-center space-x-2">
                                                <svg class="w-5 h-5 text-text-secondary" fill="currentColor" viewBox="0 0 20 20">
                                                    <path
                                                      d="M2 11a1 1 0 011-1h2a1 1 0
                                                         011 1v5a1 1 0 01-1 1H3a1 1 0
                                                         01-1-1v-5zM8 7a1 1 0 011-1h2a1
                                                         1 0 011 1v9a1 1 0 01-1
                                                         1H9a1 1 0 01-1-1V7zM14 4a1 1 0
                                                         011-1h2a1 1 0 011 1v12a1 1 0
                                                         01-1 1h-2a1 1 0 01-1-1V4z"/>
                                                </svg>
                                                <span class="text-sm font-medium">Marketing</span>
                                            </div>
                                        </div>
                                    </label>
                                    <label class="interest-option">
                                        <input type="checkbox" name="interests" value="data-science" checked class="sr-only" />
                                        <div class="interest-card p-3 border-2 border-primary rounded-lg cursor-pointer hover:border-primary transition-colors duration-200 bg-primary-50">
                                            <div class="flex items-center space-x-2">
                                                <svg class="w-5 h-5 text-primary" fill="currentColor" viewBox="0 0 20 20">
                                                    <path
                                                      d="M3 4a1 1 0 011-1h12a1 1 0
                                                         011 1v2a1 1 0 01-1 1H4a1 1 0
                                                         01-1-1V4zM3 10a1 1 0 011-1h6a1
                                                         1 0 011 1v6a1 1 0 01-1
                                                         1H4a1 1 0 01-1-1v-6zM14 9a1 1 0
                                                         00-1 1v6a1 1 0 001 1h2a1 1 0
                                                         001-1v-6a1 1 0 00-1-1h-2z"/>
                                                </svg>
                                                <span class="text-sm font-medium text-primary">Data Science</span>
                                            </div>
                                        </div>
                                    </label>
                                    <label class="interest-option">
                                        <input type="checkbox" name="interests" value="photography" class="sr-only" />
                                        <div class="interest-card p-3 border-2 border-border rounded-lg cursor-pointer hover:border-primary transition-colors duration-200">
                                            <div class="flex items-center space-x-2">
                                                <svg class="w-5 h-5 text-text-secondary" fill="currentColor" viewBox="0 0 20 20">
                                                    <path
                                                      fill-rule="evenodd"
                                                      d="M4 5a2 2 0 00-2 2v8a2 2 0
                                                         002 2h12a2 2 0 002-2V7a2 2 0
                                                         00-2-2h-1.586a1 1 0
                                                         01-.707-.293l-1.121-1.121A2 2 0
                                                         0011.172 3H8.828a2 2 0
                                                         00-1.414.586L6.293
                                                         4.707A1 1 0 015.586 5H4zm6
                                                         9a3 3 0 100-6 3 3 0 000 6z"
                                                      clip-rule="evenodd"/>
                                                </svg>
                                                <span class="text-sm font-medium">Photography</span>
                                            </div>
                                        </div>
                                    </label>
                                </div>
                            </div>

                            <!-- Learning Format Preferences -->
                            <div>
                                <label class="block text-sm font-medium text-text-primary mb-4">Preferred Learning Formats</label>
                                <div class="space-y-3">
                                    <label class="flex items-center">
                                        <input type="checkbox" name="formats" value="video" checked class="rounded border-border text-primary focus:ring-primary" />
                                        <span class="ml-3 text-sm text-text-primary">Video Courses</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="formats" value="interactive" checked class="rounded border-border text-primary focus:ring-primary" />
                                        <span class="ml-3 text-sm text-text-primary">Interactive Tutorials</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="formats" value="reading" class="rounded border-border text-primary focus:ring-primary" />
                                        <span class="ml-3 text-sm text-text-primary">Reading Materials</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="formats" value="projects" checked class="rounded border-border text-primary focus:ring-primary" />
                                        <span class="ml-3 text-sm text-text-primary">Project-Based Learning</span>
                                    </label>
                                </div>
                            </div>

                            <!-- Time Availability -->
                            <div>
                                <label for="timeAvailability" class="block text-sm font-medium text-text-primary mb-2">Weekly Learning Time</label>
                                <select id="timeAvailability" name="timeAvailability" class="input w-full">
                                    <option value="1-3">1-3 hours per week</option>
                                    <option value="4-6" selected>4-6 hours per week</option>
                                    <option value="7-10">7-10 hours per week</option>
                                    <option value="10+">More than 10 hours per week</option>
                                </select>
                            </div>

                            <div class="flex justify-end">
                                <button type="submit" id="savePreferencesBtn" class="btn btn-primary touch-target">
                                    <span id="savePreferencesText">Save Preferences</span>
                                    <svg
                                      id="savePreferencesSpinner"
                                      class="animate-spin -ml-1 mr-3 h-5 w-5 text-white hidden"
                                      xmlns="http://www.w3.org/2000/svg"
                                      fill="none"
                                      viewBox="0 0 24 24">
                                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"/>
                                        <path
                                          class="opacity-75"
                                          fill="currentColor"
                                          d="M4 12a8 8 0 018-8V0C5.373 0 0
                                             5.373 0 12h4zm2 5.291A7.962 7.962
                                             0 014 12H0c0 3.042 1.135 5.824 3
                                             7.938l3-2.647z"/>
                                    </svg>
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Account Settings Tab -->
                    <div id="settingsContent" class="tab-content hidden">
                        <div class="space-y-8">
                            <!-- Password Change Section -->
                            <div class="border-b border-border pb-8">
                                <h3 class="text-lg font-medium text-text-primary mb-4">Change Password</h3>
                                <form id="passwordForm" class="space-y-4 max-w-md">
                                    <div>
                                        <label for="currentPassword" class="block text-sm font-medium text-text-primary mb-2">Current Password</label>
                                        <input type="password" id="currentPassword" name="currentPassword" class="input w-full" required />
                                    </div>
                                    <div>
                                        <label for="newPassword" class="block text-sm font-medium text-text-primary mb-2">New Password</label>
                                        <input type="password" id="newPassword" name="newPassword" class="input w-full" required />
                                    </div>
                                    <div>
                                        <label for="confirmNewPassword" class="block text-sm font-medium text-text-primary mb-2">Confirm New Password</label>
                                        <input type="password" id="confirmNewPassword" name="confirmNewPassword" class="input w-full" required />
                                    </div>
                                    <button type="submit" id="changePasswordBtn" class="btn btn-primary touch-target">
                                        <span id="changePasswordText">Change Password</span>
                                        <svg
                                          id="changePasswordSpinner"
                                          class="animate-spin -ml-1 mr-3 h-5 w-5 text-white hidden"
                                          xmlns="http://www.w3.org/2000/svg"
                                          fill="none"
                                          viewBox="0 0 24 24">
                                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"/>
                                            <path
                                              class="opacity-75"
                                              fill="currentColor"
                                              d="M4 12a8 8 0 018-8V0C5.373 0 0
                                                 5.373 0 12h4zm2 5.291A7.962 7.962
                                                 0 014 12H0c0 3.042 1.135 5.824 3
                                                 7.938l3-2.647z"/>
                                        </svg>
                                    </button>
                                </form>
                            </div>

                            <!-- Notification Preferences -->
                            <div class="border-b border-border pb-8">
                                <h3 class="text-lg font-medium text-text-primary mb-4">Notification Preferences</h3>
                                <div class="space-y-4">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <h4 class="text-sm font-medium text-text-primary">Course Recommendations</h4>
                                            <p class="text-sm text-text-secondary">Get notified when new courses match your interests</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" id="courseNotifications" class="sr-only peer" checked />
                                            <div class="w-11 h-6 bg-border peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary-100 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
                                        </label>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <h4 class="text-sm font-medium text-text-primary">Learning Reminders</h4>
                                            <p class="text-sm text-text-secondary">Gentle reminders to continue your learning journey</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" id="learningReminders" class="sr-only peer" checked />
                                            <div class="w-11 h-6 bg-border peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary-100 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
                                        </label>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <h4 class="text-sm font-medium text-text-primary">Weekly Progress Reports</h4>
                                            <p class="text-sm text-text-secondary">Summary of your learning activities and achievements</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" id="progressReports" class="sr-only peer" />
                                            <div class="w-11 h-6 bg-border peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary-100 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
                                        </label>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <h4 class="text-sm font-medium text-text-primary">Marketing Communications</h4>
                                            <p class="text-sm text-text-secondary">Updates about new features and special offers</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" id="marketingComms" class="sr-only peer" />
                                            <div class="w-11 h-6 bg-border peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary-100 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- Data Privacy Controls -->
                            <div>
                                <h3 class="text-lg font-medium text-text-primary mb-4">Data Privacy</h3>
                                <div class="space-y-4">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <h4 class="text-sm font-medium text-text-primary">Profile Visibility</h4>
                                            <p class="text-sm text-text-secondary">Allow other learners to see your profile and achievements</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" id="profileVisibility" class="sr-only peer" />
                                            <div class="w-11 h-6 bg-border peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary-100 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
                                        </label>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <h4 class="text-sm font-medium text-text-primary">Data Analytics</h4>
                                            <p class="text-sm text-text-secondary">Help us improve by sharing anonymous usage data</p>
                                        </div>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" id="dataAnalytics" class="sr-only peer" checked />
                                            <div class="w-11 h-6 bg-border peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary-100 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary"></div>
                                        </label>
                                    </div>
                                    <div class="pt-4 border-t border-border">
                                        <button type="button" class="text-error hover:text-error-600 text-sm font-medium">
                                            Download My Data
                                        </button>
                                        <span class="mx-2 text-text-tertiary">â€¢</span>
                                        <button type="button" class="text-error hover:text-error-600 text-sm font-medium">
                                            Delete Account
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Success Messages -->
            <div id="successMessage" class="card p-4 mt-6 bg-success-50 border border-success-100 hidden">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <svg class="w-5 h-5 text-success" fill="currentColor" viewBox="0 0 20 20">
                            <path
                              fill-rule="evenodd"
                              d="M10 18a8 8 0 100-16 8 8 0 000
                                 16zm3.707-9.293a1 1 0 00-1.414-1.414L9
                                 10.586 7.707 9.293a1 1 0 00-1.414
                                 1.414l2 2a1 1 0 001.414 0l4-4z"
                              clip-rule="evenodd"/>
                        </svg>
                    </div>
                    <div class="ml-3">
                        <p id="successText" class="text-sm font-medium text-success">Profile updated successfully!</p>
                    </div>
                </div>
            </div>

            <!-- Recommendation Refresh Suggestion -->
            <div id="refreshSuggestion" class="card p-4 mt-6 bg-primary-50 border border-primary-100 hidden">
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <svg class="w-5 h-5 text-primary" fill="currentColor" viewBox="0 0 20 20">
                                <path
                                  fill-rule="evenodd"
                                  d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98
                                     0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106
                                     2.106.54.886.061 2.042-.947
                                     2.287-1.561.379-1.561 2.6 0
                                     2.978a1.532 1.532 0
                                     01.947 2.287c-.836 1.372.734 2.942
                                     2.106 2.106a1.532 1.532 0
                                     012.287.947c.379 1.561 2.6 1.561
                                     2.978 0a1.533 1.533 0
                                     012.287-.947c1.372.836 2.942-.734
                                     2.106-2.106a1.533 1.533 0
                                     01.947-2.287c1.561-.379 1.561-2.6
                                     0-2.978a1.532 1.532 0
                                     01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532
                                     1.532 0 01-2.287-.947zM10 13a3 3 0
                                     100-6 3 3 0 000 6z"
                                  clip-rule="evenodd"/>
                            </svg>
                        </div>
                        <div class="ml-3">
                            <p class="text-sm font-medium text-primary">Your preferences have been updated!</p>
                            <p class="text-sm text-primary-700">Get fresh course recommendations based on your new preferences.</p>
                        </div>
                    </div>
                    <div class="ml-4">
                        <a href="course_recommendations_dashboard.html" class="btn btn-primary text-sm px-4 py-2">
                            View Recommendations
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-surface border-t border-border mt-auto">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
            <div class="text-center text-text-secondary text-sm">
                <p>&copy; 2025 SkillUp Buddy. All Rights Reserved.</p>
            </div>
        </div>
    </footer>

    <script>
    // Complete Profile Management Script with Backend Integration + Dynamic Avatar/Initials
    document.addEventListener("DOMContentLoaded", function () {
        // âœ… FIX 1: Dynamic API_BASE - works on any PC, not just localhost
        const API_BASE = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
    ? 'http://localhost:5000'
    : 'https://skillup-buddy.onrender.com';

        // ------------- AUTH CHECK -------------
        const token = localStorage.getItem("sb_token") || localStorage.getItem("skillupToken");
        if (!token) {
            window.location.href = "user_login.html";
            return;
        }

        // ------------- UI ELEMENTS -------------
        const tabs = document.querySelectorAll(".tab-button");
        const contents = document.querySelectorAll(".tab-content");
        const userMenuButton = document.getElementById("userMenuButton");
        const userDropdown = document.getElementById("userDropdown");
        const photoInput = document.getElementById("photoInput");
        const photoUploadBtn = document.getElementById("photoUploadBtn");
        const dropZone = document.getElementById("dropZone");
        const profilePreview = document.getElementById("profilePreview");
        const userAvatar = document.getElementById("userAvatar");
        const userInitials = document.getElementById("userInitials");

        // ------------- TAB SWITCHING -------------
        tabs.forEach((tab) => {
            tab.addEventListener("click", function () {
                const targetId = this.id.replace("Tab", "Content");

                tabs.forEach((t) => {
                    t.classList.remove("active", "border-primary", "text-primary");
                    t.classList.add("border-transparent", "text-text-secondary");
                });

                this.classList.add("active", "border-primary", "text-primary");
                this.classList.remove("border-transparent", "text-text-secondary");

                contents.forEach((content) => content.classList.add("hidden"));
                document.getElementById(targetId).classList.remove("hidden");
            });
        });

        // ------------- USER MENU DROPDOWN -------------
        userMenuButton.addEventListener("click", function (e) {
            e.stopPropagation();
            userDropdown.classList.toggle("hidden");
        });

        document.addEventListener("click", function () {
            userDropdown.classList.add("hidden");
        });

        // Sign out
        const signOutLink = document.querySelector('a[href="user_login.html"]');
        if (signOutLink) {
            signOutLink.addEventListener("click", function (e) {
                e.preventDefault();
                localStorage.clear();
                window.location.href = "user_login.html";
            });
        }

        // ------------- PHOTO UPLOAD -------------
        photoUploadBtn.addEventListener("click", () => photoInput.click());
        dropZone.addEventListener("click", () => photoInput.click());

        dropZone.addEventListener("dragover", function (e) {
            e.preventDefault();
            this.classList.add("border-primary", "bg-primary-50");
        });

        dropZone.addEventListener("dragleave", function (e) {
            e.preventDefault();
            this.classList.remove("border-primary", "bg-primary-50");
        });

        dropZone.addEventListener("drop", function (e) {
            e.preventDefault();
            this.classList.remove("border-primary", "bg-primary-50");
            if (e.dataTransfer.files.length > 0) {
                handleFileUpload(e.dataTransfer.files[0]);
            }
        });

        photoInput.addEventListener("change", function (e) {
            if (e.target.files.length > 0) {
                handleFileUpload(e.target.files[0]);
            }
        });

        function handleFileUpload(file) {
            if (!file.type.startsWith("image/")) {
                alert("Please select an image file.");
                return;
            }
            if (file.size > 5 * 1024 * 1024) {
                alert("File size must be less than 5MB.");
                return;
            }

            const reader = new FileReader();
            reader.onload = function (e) {
                profilePreview.src = e.target.result;
                userAvatar.src = e.target.result;
                userAvatar.classList.remove("hidden");
                userInitials.classList.add("hidden");
            };
            reader.readAsDataURL(file);
        }

        // ------------- SKILL LEVEL UI -------------
        const skillLevelOptions = document.querySelectorAll(".skill-level-option");
        skillLevelOptions.forEach((option) => {
            option.addEventListener("click", function () {
                skillLevelOptions.forEach((opt) => {
                    const card = opt.querySelector(".skill-card");
                    const icon = opt.querySelector(".w-8");
                    const text = opt.querySelector("span");
                    card.classList.remove("border-primary", "bg-primary-50");
                    card.classList.add("border-border");
                    icon.classList.remove("bg-primary");
                    icon.classList.add("bg-primary-100");
                    text.classList.remove("text-primary");
                    opt.querySelector("input").checked = false;
                });

                const card = this.querySelector(".skill-card");
                const icon = this.querySelector(".w-8");
                const text = this.querySelector("span");
                card.classList.add("border-primary", "bg-primary-50");
                card.classList.remove("border-border");
                icon.classList.add("bg-primary");
                icon.classList.remove("bg-primary-100");
                text.classList.add("text-primary");
                this.querySelector("input").checked = true;
            });
        });

        // ------------- INTERESTS UI -------------
        const interestOptions = document.querySelectorAll(".interest-option");
        interestOptions.forEach((option) => {
            option.addEventListener("click", function () {
                const checkbox = this.querySelector("input");
                const card = this.querySelector(".interest-card");
                const icon = card.querySelector("svg");
                const text = card.querySelector("span");

                checkbox.checked = !checkbox.checked;

                if (checkbox.checked) {
                    card.classList.add("border-primary", "bg-primary-50");
                    card.classList.remove("border-border");
                    icon.classList.add("text-primary");
                    icon.classList.remove("text-text-secondary");
                    text.classList.add("text-primary");
                } else {
                    card.classList.remove("border-primary", "bg-primary-50");
                    card.classList.add("border-border");
                    icon.classList.remove("text-primary");
                    icon.classList.add("text-text-secondary");
                    text.classList.remove("text-primary");
                }
            });
        });

        // ------------- FORM SUBMISSIONS -------------
        const personalForm = document.getElementById("personalForm");
        const preferencesForm = document.getElementById("preferencesForm");
        const passwordForm = document.getElementById("passwordForm");

        personalForm.addEventListener("submit", async function (e) {
            e.preventDefault();
            await handlePersonalFormSubmission();
        });

        preferencesForm.addEventListener("submit", async function (e) {
            e.preventDefault();
            await handlePreferencesFormSubmission();
        });

        passwordForm.addEventListener("submit", async function (e) {
            e.preventDefault();
            await handlePasswordFormSubmission();
        });

        async function handlePersonalFormSubmission() {
            const button = document.getElementById("savePersonalBtn");
            const text = document.getElementById("savePersonalText");
            const spinner = document.getElementById("savePersonalSpinner");
            const originalText = text.textContent;

            button.disabled = true;
            text.textContent = "Saving...";
            spinner.classList.remove("hidden");

            try {
                const formData = {
                    firstName: document.getElementById("firstName").value,
                    lastName: document.getElementById("lastName").value,
                    email: document.getElementById("email").value,
                    phone: document.getElementById("phone").value || "",
                    location: document.getElementById("location").value || "",
                    bio: document.getElementById("bio").value || "",
                    profilePhoto: profilePreview.src // will be "" if not set
                };

                const response = await fetch(`${API_BASE}/api/profile/update`, {
                    method: "PUT",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": `Bearer ${token}`
                    },
                    body: JSON.stringify(formData)
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.message || "Failed to update profile");
                }

                // Update local storage
                localStorage.setItem("sb_user", JSON.stringify(data.user));
                localStorage.setItem("skillupUser", JSON.stringify(data.user));

                // Update header name + avatar/initials
                const fullName =
                    `${data.user.firstName || ""} ${data.user.lastName || ""}`.trim();
                const headerNameEl = document.getElementById("userName");
                headerNameEl.textContent = fullName || data.user.email || "My Profile";

                const initials =
                    (data.user.firstName ? data.user.firstName.charAt(0) : "") +
                    (data.user.lastName ? data.user.lastName.charAt(0) : "");

                if (data.user.profilePhoto) {
                    userAvatar.src = data.user.profilePhoto;
                    userAvatar.classList.remove("hidden");
                    userInitials.classList.add("hidden");
                } else {
                    userAvatar.classList.add("hidden");
                    userInitials.textContent = (initials || "SB").toUpperCase();
                    userInitials.classList.remove("hidden");
                }

                showSuccessMessage("Personal information updated successfully!");

            } catch (error) {
                alert(error.message || "Failed to update profile. Please try again.");
            } finally {
                button.disabled = false;
                text.textContent = originalText;
                spinner.classList.add("hidden");
            }
        }

        async function handlePreferencesFormSubmission() {
            const button = document.getElementById("savePreferencesBtn");
            const text = document.getElementById("savePreferencesText");
            const spinner = document.getElementById("savePreferencesSpinner");
            const originalText = text.textContent;

            button.disabled = true;
            text.textContent = "Saving...";
            spinner.classList.remove("hidden");

            try {
                const skillLevel = document.querySelector('input[name="skillLevel"]:checked')?.value || "";
                const interests = Array.from(document.querySelectorAll('input[name="interests"]:checked'))
                    .map(cb => cb.value);
                const learningFormats = Array.from(document.querySelectorAll('input[name="formats"]:checked'))
                    .map(cb => cb.value);
                const timeAvailability = document.getElementById("timeAvailability").value;

                const formData = {
                    skillLevel,
                    interests,
                    learningFormats,
                    timeAvailability
                };

                const response = await fetch(`${API_BASE}/api/profile/update`, {
                    method: "PUT",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": `Bearer ${token}`
                    },
                    body: JSON.stringify(formData)
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.message || "Failed to update preferences");
                }

                showSuccessMessage("Learning preferences saved successfully!");
                document.getElementById("refreshSuggestion").classList.remove("hidden");

            } catch (error) {
                alert(error.message || "Failed to save preferences. Please try again.");
            } finally {
                button.disabled = false;
                text.textContent = originalText;
                spinner.classList.add("hidden");
            }
        }

        async function handlePasswordFormSubmission() {
            const button = document.getElementById("changePasswordBtn");
            const text = document.getElementById("changePasswordText");
            const spinner = document.getElementById("changePasswordSpinner");
            const originalText = text.textContent;

            const currentPassword = document.getElementById("currentPassword").value;
            const newPassword = document.getElementById("newPassword").value;
            const confirmNewPassword = document.getElementById("confirmNewPassword").value;

            if (newPassword !== confirmNewPassword) {
                alert("New passwords do not match!");
                return;
            }

            if (newPassword.length < 8) {
                alert("New password must be at least 8 characters long!");
                return;
            }

            button.disabled = true;
            text.textContent = "Changing...";
            spinner.classList.remove("hidden");

            try {
                const response = await fetch(`${API_BASE}/api/profile/change-password`, {
                    method: "PUT",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        currentPassword,
                        newPassword
                    })
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.message || "Failed to change password");
                }

                showSuccessMessage("Password changed successfully!");
                passwordForm.reset();

            } catch (error) {
                alert(error.message || "Failed to change password. Please try again.");
            } finally {
                button.disabled = false;
                text.textContent = originalText;
                spinner.classList.add("hidden");
            }
        }

        function showSuccessMessage(message) {
            const successMessage = document.getElementById("successMessage");
            const successText = document.getElementById("successText");

            successText.textContent = message;
            successMessage.classList.remove("hidden");
            successMessage.classList.add("success-animation");

            setTimeout(() => {
                successMessage.classList.add("hidden");
            }, 5000);
        }

        // ------------- LOAD USER DATA -------------
        async function loadUserData() {
            try {
                const response = await fetch(`${API_BASE}/api/auth/me`, {
                    headers: {
                        "Authorization": `Bearer ${token}`
                    }
                });

                if (!response.ok) {
                    throw new Error("Failed to fetch user data");
                }

                const data = await response.json();

                // âœ… FIX 2: Server returns { success, user:{...} } so use data.user not data
                const user = data.user || data;

                // Update form fields
                document.getElementById("firstName").value = user.firstName || "";
                document.getElementById("lastName").value = user.lastName || "";
                document.getElementById("email").value = user.email || "";
                document.getElementById("phone").value = user.phone || "";
                document.getElementById("location").value = user.location || "";
                document.getElementById("bio").value = user.bio || "";

                // Header name
                const fullName =
                    `${user.firstName || ""} ${user.lastName || ""}`.trim();
                const headerNameEl = document.getElementById("userName");
                headerNameEl.textContent = fullName || user.email || "My Profile";

                const initials =
                    (user.firstName ? user.firstName.charAt(0) : "") +
                    (user.lastName ? user.lastName.charAt(0) : "");

                // Profile photos
                if (user.profilePhoto) {
                    profilePreview.src = user.profilePhoto;
                    userAvatar.src = user.profilePhoto;
                    userAvatar.classList.remove("hidden");
                    userInitials.classList.add("hidden");
                } else {
                    profilePreview.src = "";
                    userAvatar.classList.add("hidden");
                    userInitials.textContent = (initials || "SB").toUpperCase();
                    userInitials.classList.remove("hidden");
                }

                // âœ… FIX 3: Save the correct user object to localStorage
                localStorage.setItem("sb_user", JSON.stringify(user));
                localStorage.setItem("skillupUser", JSON.stringify(user));

                // âœ… FIX 4: Populate learning preferences from saved user data
                if (user.skillLevel) {
                    const skillRadio = document.querySelector(`input[name="skillLevel"][value="${user.skillLevel}"]`);
                    if (skillRadio) skillRadio.checked = true;
                }
                if (user.interests && Array.isArray(user.interests)) {
                    document.querySelectorAll('input[name="interests"]').forEach(cb => {
                        cb.checked = user.interests.includes(cb.value);
                    });
                }
                if (user.learningFormats && Array.isArray(user.learningFormats)) {
                    document.querySelectorAll('input[name="formats"]').forEach(cb => {
                        cb.checked = user.learningFormats.includes(cb.value);
                    });
                }
                if (user.timeAvailability) {
                    const timeEl = document.getElementById("timeAvailability");
                    if (timeEl) timeEl.value = user.timeAvailability;
                }
                // Notification toggles
                if (user.notifications) {
                    const n = user.notifications;
                    const setCheck = (id, val) => { const el = document.getElementById(id); if (el) el.checked = !!val; };
                    setCheck("courseNotifications", n.courseRecommendations);
                    setCheck("learningReminders", n.learningReminders);
                    setCheck("progressReports", n.progressReports);
                    setCheck("marketingComms", n.marketingComms);
                }

            } catch (error) {
                console.error("Error loading user data:", error);
                // Fallback: load from localStorage
                const storedUser = localStorage.getItem("sb_user") || localStorage.getItem("skillupUser");
                if (storedUser) {
                    const user = JSON.parse(storedUser);
                    document.getElementById("firstName").value = user.firstName || "";
                    document.getElementById("lastName").value = user.lastName || "";
                    document.getElementById("email").value = user.email || "";
                    document.getElementById("phone").value = user.phone || "";
                    document.getElementById("location").value = user.location || "";
                    document.getElementById("bio").value = user.bio || "";

                    const fullName =
                        `${user.firstName || ""} ${user.lastName || ""}`.trim();
                    const headerNameEl = document.getElementById("userName");
                    headerNameEl.textContent = fullName || user.email || "My Profile";

                    const initials =
                        (user.firstName ? user.firstName.charAt(0) : "") +
                        (user.lastName ? user.lastName.charAt(0) : "");

                    if (user.profilePhoto) {
                        profilePreview.src = user.profilePhoto;
                        userAvatar.src = user.profilePhoto;
                        userAvatar.classList.remove("hidden");
                        userInitials.classList.add("hidden");
                    } else {
                        profilePreview.src = "";
                        userAvatar.classList.add("hidden");
                        userInitials.textContent = (initials || "SB").toUpperCase();
                        userInitials.classList.remove("hidden");
                    }
                }
            }
        }

        // Load user data on page load
        loadUserData();
    });
    </script>

    <script id="dhws-dataInjector" src="../public/dhws-data-injector.js"></script>
    <script src="../js/userDataSync.js"></script>
</body>
</html>